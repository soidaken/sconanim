window.__require=function t(e,n,i){function o(r,s){if(!n[r]){if(!e[r]){var c=r.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+r+"'")}r=c}var p=n[r]={exports:{}};e[r][0].call(p.exports,function(t){return o(e[r][1][t]||t)},p,p.exports,t,e,n,i)}return n[r].exports}for(var a="function"==typeof __require&&__require,r=0;r<i.length;r++)o(i[r]);return o}({SconAnim:[function(t,e,n){"use strict";cc._RF.push(e,"0e7b5guslVJ0IA9thHiB+8z","SconAnim");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0}),n.SconAnim=n.SconAnimEvents=void 0;var r=cc.Node,s=(cc.Label,cc.Component),c=cc.JsonAsset,l=cc.Sprite,p=cc._decorator,u=p.ccclass,h=p.property,f=t("./spriter");n.SconAnimEvents=new cc.EventTarget;var y=function(t){function e(){var e=t.call(this)||this;return e.sconAsset=null,e.loop=!0,e.animation="",e.playOnLoad=!0,e.timeScale=1,e.debug=!1,e._sconPath="",e.entity="",e._ready=!1,e._pose=null,e._sprites=new Map,e._spriteNodes=new Map,e._currentAnimationTime=0,e._animationFinished=!1,e._basePath="",e._loadedSpriteFrames=new Map,e._isPlaying=!1,e}return o(e,t),e.prototype.setFilePath=function(t){this._sconPath=t.split(".")[0]},e.prototype.onLoad=function(){if(n.SconAnimEvents.on("animationComplete",this._onAnimationComplete,this),this.sconAsset){var t=cc.resources.getAssetInfo(this.sconAsset._uuid);this._sconPath=t.path}},e.prototype.start=function(){this._sconPath&&(this._basePath=this._getSconBasePath(),this._loadAnimation()),this.debug},e.prototype.onDestroy=function(){n.SconAnimEvents.off("animationComplete",this._onAnimationComplete,this),this._sprites.clear(),this._spriteNodes.clear(),this._loadedSpriteFrames.clear(),this._pose=null},e.prototype.update=function(t){if(this._ready&&this._pose&&this._isPlaying){var e=1e3*t*this.timeScale;this._pose.update(e),this._pose.strike(),this._hideAllSprites(),this._updateSpriteFrames(),this.loop||this._checkAnimationCompletion()}},e.prototype._checkAnimationCompletion=function(){if(this._pose){var t=this._pose.getTime();t<this._currentAnimationTime&&(this._stopAnimation(),n.SconAnimEvents.emit("animationComplete",{entity:this.entity,animation:this.animation})),this._currentAnimationTime=t}},e.prototype._onAnimationComplete=function(t){t.entity===this.entity&&t.animation===this.animation&&(this._animationFinished=!0)},e.prototype._stopAnimation=function(){this._pose&&(this._animationFinished=!0,this._isPlaying=!1)},e.prototype._getSconBasePath=function(){var t=this._sconPath.lastIndexOf("/");return-1!==t?this._sconPath.substring(0,t+1):""},e.prototype._loadAnimation=function(){var t=this;this.debug&&console.log("SconAnim: Loading animation from "+this._sconPath);var e=cc.resources;e.load(this._sconPath,c,function(n,i){if(n)console.error("SconAnim: Failed to load SCON file "+t._sconPath+": "+n);else{t.debug&&console.log("SconAnim: Successfully loaded SCON data");var o=i.json,a=(new f.Data).load(o);t._pose=new f.Pose(a);var r=a.getEntityKeys();if(console.log("SconAnim: Available entities:",r),!t.entity&&r.length>0&&(t.entity=r[0],t.debug&&console.log("SconAnim: No entity specified, using first available: "+t.entity)),t.entity){var s=a.getAnimKeys(t.entity);t.debug&&console.log("SconAnim: Available animations for entity '"+t.entity+"':",s),!t.animation&&s.length>0&&(t.animation=s[0],t.debug&&console.log("SconAnim: No animation specified, using first available: "+t.animation))}t._loadSpriteFrames(a,e,function(){t.debug&&console.log("SconAnim: All sprite frames loaded successfully"),t.node.removeAllChildren(),t._pose&&(t.debug&&console.log("SconAnim: Setting entity "+t.entity+" and animation "+t.animation),t._pose.setEntity(t.entity),t._pose.setAnim(t.animation),t._pose.strike(),t.debug&&console.log("SconAnim: Pose object_array length after strike: "+t._pose.object_array.length),t.debug&&console.log("SconAnim: Sprites in pose: "+t._pose.object_array.filter(function(t){return"sprite"===t.type}).length),t._initSpritePool(),t._ready=!0),t.playOnLoad&&t.play()})}})},e.prototype._loadSpriteFrames=function(t,e,n){var i=this,o=0;t.folder_array.forEach(function(t){t.file_array.forEach(function(t){"image"===t.type&&o++})}),0!==o?(this.debug&&console.log("SconAnim: Loading "+o+" sprite frames"),t.folder_array.forEach(function(t){t.file_array.forEach(function(t){if("image"===t.type){var a=t.name,r=t.name.includes(".")?t.name.substring(0,t.name.lastIndexOf(".")):t.name,s=""+i._basePath+r;i.debug&&i.debug&&console.log("SconAnim: Loading sprite "+s+"/spriteFrame"),e.load(""+s,cc.SpriteFrame,function(t,e){t?console.error("SconAnim: Failed to load sprite frame: "+s,t):(i._loadedSpriteFrames.set(a,e),0==--o&&n())})}})})):n()},e.prototype._initSpritePool=function(){var t=this;if(this._pose){var e=this._pose.object_array.filter(function(t){return"sprite"===t.type});this.debug&&console.log("SconAnim: Initializing "+e.length+" sprites"),this._pose.object_array.forEach(function(e,n){t.debug&&t.debug&&console.log("SconAnim: Pose object "+n+": type="+e.type+", name="+e.name)}),e.forEach(function(e,n){var i=e;if(i.folder_index<0||i.folder_index>=t._pose.data.folder_array.length)console.error("SconAnim: Invalid folder index "+i.folder_index+" for sprite object "+n);else{var o=t._pose.data.folder_array[i.folder_index];if(i.file_index<0||i.file_index>=o.file_array.length)console.error("SconAnim: Invalid file index "+i.file_index+" for sprite object "+n+" in folder "+i.folder_index);else{var a=o.file_array[i.file_index],s=a.name,c=t._loadedSpriteFrames.get(s);if(c){var p=new r("node_"+n),u=p;u.width=a.width,u.height=a.height,p.opacity=0;var h=p.addComponent(l);h.spriteFrame=c;var f="node_"+n;t._sprites.set(f,h),t._spriteNodes.set(f,p),t.node.addChild(p)}else console.warn("SconAnim: Missing sprite frame for "+s)}}}),this.debug&&console.log("SconAnim: Initialized sprite pool. Children count: "+this.node.children.length)}},e.prototype._hideAllSprites=function(){this._spriteNodes.forEach(function(t){t&&(t.opacity=0)})},e.prototype._updateSpriteFrames=function(){var t=this;this._pose&&this._pose.object_array.filter(function(t){return"sprite"===t.type}).map(function(t,e){return{object:t,index:e}}).forEach(function(e,n){var i=e.object,o=t._pose.data.folder_array[i.folder_index].file_array[i.file_index].name,a=t._loadedSpriteFrames.get(o);if(a){var r="node_"+e.index,s=t._spriteNodes.get(r);if(s){var c=i.world_space;s.setPosition(Number(c.position.x),Number(c.position.y),0),s.setScale(c.scale.x,c.scale.y,1),s.angle=c.rotation.deg,s&&(s.opacity=255*i.alpha);var l=t._sprites.get(r);l&&l.spriteFrame!==a&&(l.spriteFrame=a),s.setSiblingIndex(n)}else t.debug&&console.warn("SconAnim: Missing sprite node for "+r)}})},e.prototype.play=function(){this.debug&&console.log("SconAnim: Play animation "+this.animation),this._isPlaying=!0,this._animationFinished=!1,this._currentAnimationTime=0,this._ready&&this._pose&&(this.debug&&console.log("SconAnim: Object array length before play: "+this._pose.object_array.length),this.debug&&console.log("SconAnim: Sprites in pose before play: "+this._pose.object_array.filter(function(t){return"sprite"===t.type}).length),this._pose.strike(),this._hideAllSprites(),this._updateSpriteFrames())},e.prototype.pause=function(){this._isPlaying=!1},e.prototype.stop=function(){this._isPlaying=!1,this._animationFinished=!1,this._pose&&this._pose.setTime(0),this._currentAnimationTime=0},e.prototype.setLoop=function(t){this.loop=t,this._animationFinished&&(this._animationFinished=!1,this._isPlaying=!0)},e.prototype.setEntity=function(t){this.entity=t,this._ready&&this._pose&&(this._pose.setEntity(t),this._currentAnimationTime=0)},e.prototype.setAnim=function(t){this.animation=t,this._ready&&this._pose&&(this._pose.setAnim(t),this._currentAnimationTime=0,this._animationFinished=!1)},e.prototype.setTimeScale=function(t){this.timeScale=t},e.prototype.isFinished=function(){return this._animationFinished},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isReady=function(){return this._ready},e.prototype.getAnimTime=function(){var t;return(null===(t=this._pose)||void 0===t?void 0:t.getTime())||0},e.prototype.getAvailableAnimations=function(){return this._pose&&this._pose.data?this._pose.data.getAnimKeys(this.entity):[]},e.prototype.getAvailableEntities=function(){return this._pose&&this._pose.data?this._pose.data.getEntityKeys():[]},e.prototype.dumpPoseInfo=function(){this._pose?this.debug&&(console.log("====== SconAnim Pose Debug Info ======"),console.log("Entity: "+this.entity+", Animation: "+this.animation),console.log("Available entities: "+this._pose.data.getEntityKeys().join(", ")),console.log("Available animations: "+this._pose.data.getAnimKeys(this.entity).join(", ")),console.log("Total objects in pose: "+this._pose.object_array.length),console.log("Sprite objects: "+this._pose.object_array.filter(function(t){return"sprite"===t.type}).length),console.log("Bone objects: "+this._pose.object_array.filter(function(t){return"bone"===t.type}).length),console.log("======================================")):console.log("SconAnim: No pose available")},a([h(c)],e.prototype,"sconAsset",void 0),a([h],e.prototype,"loop",void 0),a([h],e.prototype,"animation",void 0),a([h],e.prototype,"playOnLoad",void 0),a([h],e.prototype,"timeScale",void 0),a([h],e.prototype,"debug",void 0),a([u("SconAnim")],e)}(s);n.SconAnim=y,cc._RF.pop()},{"./spriter":"spriter"}],scene_scon:[function(t,e,n){"use strict";cc._RF.push(e,"2e3748Hx71GAKKXV59NsUL0","scene_scon");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0}),n.scene_scon=void 0;var r=t("./pack/SconAnim"),s=cc.Node,c=cc.Label,l=cc.Component,p=cc._decorator,u=p.ccclass,h=p.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.node_next=null,e.node_pre=null,e._sconNodes=[],e._nodeAnimStates=new Map,e}return o(e,t),e.prototype.onLoad=function(){var t=this;this.node_pre.on("click",function(){t.playPreviousAnimation()},this),this.node_next.on("click",function(){t.playNextAnimation()},this)},e.prototype.start=function(){var t=this;if(this._sconNodes=this.node.children.filter(function(t){return null!==t.getComponent(r.SconAnim)}),console.log("Found "+this._sconNodes.length+" SconAnim nodes."),0!==this._sconNodes.length){var e=function(){t._sconNodes.every(function(t){var e=t.getComponent(r.SconAnim);return e&&e.isReady()})?(t.unschedule(e),console.log("All SconAnim nodes are loaded."),t.initializeNodeStatesAndPlayFirst()):console.log("Waiting for SconAnim nodes to load...")};this.schedule(e,1/60,1/0,0)}else console.warn("No SconAnim nodes found under this node.")},e.prototype.initializeNodeStatesAndPlayFirst=function(){var t=this;this._sconNodes.forEach(function(e){var n=e.getComponent(r.SconAnim);if(n){var i=n.getAvailableAnimations();if(0===i.length)return console.warn("Node "+e.name+" has no animations."),void t._nodeAnimStates.set(e,{animNames:[],currentIndex:-1});var o={animNames:i,currentIndex:0};t._nodeAnimStates.set(e,o);var a=e.getChildByName("name"),l=null;a?l=a.getComponent(c):(a=new s("name"),e.addChild(a),l=a.addComponent(c),a.setPosition(0,-40,0));var p=o.animNames[o.currentIndex];n.setAnim(p),l&&(l.string=p),console.log("Node "+e.name+" initialized with animation: "+p)}})},e.prototype.playNextAnimation=function(){var t=this;console.log("Playing next animation for all nodes..."),this._sconNodes.forEach(function(e){var n,i=t._nodeAnimStates.get(e);if(i&&0!==i.animNames.length){var o=i.currentIndex+1;o>=i.animNames.length&&(o=0),i.currentIndex=o;var a=i.animNames[o],s=e.getComponent(r.SconAnim),l=null===(n=e.getChildByName("name"))||void 0===n?void 0:n.getComponent(c);s&&s.setAnim(a),l&&(l.string=a),console.log("Node "+e.name+" playing next: "+a)}})},e.prototype.playPreviousAnimation=function(){var t=this;console.log("Playing previous animation for all nodes..."),this._sconNodes.forEach(function(e){var n,i=t._nodeAnimStates.get(e);if(i&&0!==i.animNames.length){var o=i.currentIndex-1;o<0&&(o=i.animNames.length-1),i.currentIndex=o;var a=i.animNames[o],s=e.getComponent(r.SconAnim),l=null===(n=e.getChildByName("name"))||void 0===n?void 0:n.getComponent(c);s&&s.setAnim(a),l&&(l.string=a),console.log("Node "+e.name+" playing previous: "+a)}})},e.prototype.update=function(){},a([h(cc.Node)],e.prototype,"node_next",void 0),a([h(cc.Node)],e.prototype,"node_pre",void 0),a([u("scene_scon")],e)}(l);n.scene_scon=f,cc._RF.pop()},{"./pack/SconAnim":"SconAnim"}],spriter:[function(t,e,n){"use strict";cc._RF.push(e,"476a6x96n1LR7INfQXkaVf0","spriter");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});function a(t,e,n){var i=t[e];switch(typeof i){case"string":return"true"===i;case"boolean":return i;default:return n||!1}}function r(t,e,n){var i=t[e];switch(typeof i){case"string":return parseFloat(i);case"number":return i;default:return n||0}}function s(t,e,n){var i=t[e];switch(typeof i){case"string":return parseInt(i,10);case"number":return 0|i;default:return n||0}}function c(t,e,n){var i=t[e];switch(typeof i){case"string":return i;default:return n||""}}function l(t){return"object"==typeof t&&"number"==typeof t.length?t:void 0!==t?[t]:[]}function p(t,e,n){return e<n?t<e?n-(e-t)%(n-e):e+(t-e)%(n-e):e===n?e:t}function u(t,e,n){return t+(e-t)*n}function h(t,e,n,i){return u(u(t,e,i),u(e,n,i),i)}function f(t,e,n,i,o){return u(h(t,e,n,o),h(e,n,i,o),o)}function y(t,e,n,i,o,a){return u(f(t,e,n,i,a),f(e,n,i,o,a),a)}function d(t,e,n,i,o,a,r){return u(y(t,e,n,i,o,r),y(e,n,i,o,a,r),r)}function _(t,e,n,i,o){function a(t,e,n,i){return((t*i+e)*i+n)*i}function r(t,e,n,i){return(3*t*i+2*e)*i+n}function s(t,e,n,i,o){var s,c,l,p,u,h;for(l=i,h=0;h<8;h++){if(p=a(t,e,n,l)-i,Math.abs(p)<o)return l;if(u=r(t,e,n,l),Math.abs(u)<o)break;l-=p/u}if((l=i)<(s=0))return s;if(l>(c=1))return c;for(;s<c;){if(p=a(t,e,n,l),Math.abs(p-i)<o)return l;i>p?s=l:c=l,l=.5*(c-s)+s}return l}var c=3*t,l=3*(n-t)-c,p=3*e,u=3*(i-e)-p;return function(t,e,n,i,r,c){return a(i,r,c,s(t,e,n,o,function(t){return 1/(200*t)}(1)))}(1-c-l,l,c,1-p-u,u,p)}function m(t,e,n){return t+(e-t)*n}function v(t){return t<=0?(t-Math.PI)%(2*Math.PI)+Math.PI:(t+Math.PI)%(2*Math.PI)-Math.PI}function g(t,e,n,i){return 0===i?t:(i>0?e-t<0&&(e+=2*Math.PI):i<0&&e-t>0&&(e-=2*Math.PI),v(t+v(e-t)*n))}Object.defineProperty(n,"__esModule",{value:!0}),n.TaglineKeyframe=n.Tag=n.TagDef=n.VariableTimelineKeyframe=n.EntityTimelineKeyframe=n.SoundTimelineKeyframe=n.PointTimelineKeyframe=n.BoxTimelineKeyframe=n.BoneTimelineKeyframe=n.SpriteTimelineKeyframe=n.TimelineKeyframe=n.Mainline=n.MainlineKeyframe=n.Curve=n.Keyframe=n.ObjectRef=n.BoneRef=n.Ref=n.VariableObject=n.EntityObject=n.SoundObject=n.PointObject=n.BoxObject=n.Bone=n.SpriteObject=n.BaseObject=n.Folder=n.SoundFile=n.ImageFile=n.File=n.Element=n.Space=n.Pivot=n.Scale=n.Rotation=n.Position=n.Vector=n.Angle=n.tweenAngleRadians=n.wrapAngleRadians=n.tween=n.wrap=n.saveString=n.loadString=n.saveInt=n.loadInt=n.saveFloat=n.loadFloat=n.saveBool=n.loadBool=void 0,n.Pose=n.Data=n.Entity=n.Animation=n.BoxObjInfo=n.BoneObjInfo=n.SpriteObjInfo=n.SpriteFrame=n.ObjInfo=n.VarDefs=n.VarDef=n.CharacterMap=n.MapInstruction=n.Eventline=n.EventlineKeyframe=n.Soundline=n.SoundlineKeyframe=n.Timeline=n.Meta=n.Varline=n.VarlineKeyframe=n.Tagline=void 0,n.loadBool=a,n.saveBool=function(t,e,n,i){"boolean"==typeof i&&n===i||(t[e]=n)},n.loadFloat=r,n.saveFloat=function(t,e,n,i){"number"==typeof i&&n===i||(t[e]=n)},n.loadInt=s,n.saveInt=function(t,e,n,i){"number"==typeof i&&n===i||(t[e]=n)},n.loadString=c,n.saveString=function(t,e,n,i){"string"==typeof i&&n===i||(t[e]=n)},n.wrap=p,n.tween=m,n.wrapAngleRadians=v,n.tweenAngleRadians=g;var b=function(){function t(t){void 0===t&&(t=0),this.rad=0,this.rad=t}return Object.defineProperty(t.prototype,"deg",{get:function(){return 180*this.rad/Math.PI},set:function(t){this.rad=t*Math.PI/180},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cos",{get:function(){return Math.cos(this.rad)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sin",{get:function(){return Math.sin(this.rad)},enumerable:!1,configurable:!0}),t.prototype.selfIdentity=function(){return this.rad=0,this},t.prototype.copy=function(t){return this.rad=t.rad,this},t.add=function(e,n,i){return void 0===i&&(i=new t),i.rad=v(e.rad+n.rad),i},t.prototype.add=function(e,n){return void 0===n&&(n=new t),t.add(this,e,n)},t.prototype.selfAdd=function(e){return t.add(this,e,this)},t.tween=function(e,n,i,o,a){return void 0===a&&(a=new t),a.rad=g(e.rad,n.rad,i,o),a},t.prototype.tween=function(e,n,i,o){return void 0===o&&(o=new t),t.tween(this,e,n,i,o)},t.prototype.selfTween=function(e,n,i){return t.tween(this,e,n,i,this)},t}();n.Angle=b;var x=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.equal=function(t,e,n){return void 0===n&&(n=1e-6),!(Math.abs(t.x-e.x)>n||Math.abs(t.y-e.y)>n)},t.add=function(e,n,i){return void 0===i&&(i=new t),i.x=e.x+n.x,i.y=e.y+n.y,i},t.prototype.add=function(e,n){return void 0===n&&(n=new t),t.add(this,e,n)},t.prototype.selfAdd=function(t){return this.x+=t.x,this.y+=t.y,this},t.tween=function(e,n,i,o){return void 0===o&&(o=new t),o.x=m(e.x,n.x,i),o.y=m(e.y,n.y,i),o},t.prototype.tween=function(e,n,i){return void 0===i&&(i=new t),t.tween(this,e,n,i)},t.prototype.selfTween=function(e,n){return t.tween(this,e,n,this)},t}();n.Vector=x;var w=function(t){function e(){return t.call(this,0,0)||this}return o(e,t),e}(x);n.Position=w;var k=function(t){function e(){return t.call(this,0)||this}return o(e,t),e}(b);n.Rotation=k;var A=function(t){function e(){return t.call(this,1,1)||this}return o(e,t),e.prototype.selfIdentity=function(){return this.x=1,this.y=1,this},e}(x);n.Scale=A;var E=function(t){function e(){return t.call(this,0,1)||this}return o(e,t),e.prototype.selfIdentity=function(){return this.x=0,this.y=1,this},e}(x);n.Pivot=E;var S=function(){function t(){this.position=new w,this.rotation=new k,this.scale=new A}return t.prototype.copy=function(t){return this.position.copy(t.position),this.rotation.copy(t.rotation),this.scale.copy(t.scale),this},t.prototype.load=function(t){return this.position.x=r(t,"x",0),this.position.y=r(t,"y",0),this.rotation.deg=r(t,"angle",0),this.scale.x=r(t,"scale_x",1),this.scale.y=r(t,"scale_y",1),this},t.equal=function(t,e,n){return void 0===n&&(n=1e-6),!(Math.abs(t.position.x-e.position.x)>n||Math.abs(t.position.y-e.position.y)>n||Math.abs(t.rotation.rad-e.rotation.rad)>n||Math.abs(t.scale.x-e.scale.x)>n||Math.abs(t.scale.y-e.scale.y)>n)},t.identity=function(e){return void 0===e&&(e=new t),e.position.x=0,e.position.y=0,e.rotation.rad=0,e.scale.x=1,e.scale.y=1,e},t.translate=function(t,e,n){e*=t.scale.x,n*=t.scale.y;var i=t.rotation.rad,o=Math.cos(i),a=Math.sin(i),r=o*e-a*n,s=a*e+o*n;return t.position.x+=r,t.position.y+=s,t},t.rotate=function(t,e){return t.rotation.rad=v(t.rotation.rad+e),t},t.scale=function(t,e,n){return t.scale.x*=e,t.scale.y*=n,t},t.invert=function(e,n){n=n||new t;var i=1/e.scale.x,o=1/e.scale.y,a=-e.rotation.rad,r=-e.position.x,s=-e.position.y;n.scale.x=i,n.scale.y=o,n.rotation.rad=a;var c=r,l=s,p=a,u=Math.cos(p),h=Math.sin(p),f=u*c-h*l,y=h*c+u*l;return n.position.x=f*i,n.position.y=y*o,n},t.combine=function(e,n,i){i=i||new t;var o=n.position.x*e.scale.x,a=n.position.y*e.scale.y,r=e.rotation.rad,s=Math.cos(r),c=Math.sin(r),l=s*o-c*a,p=c*o+s*a;return i.position.x=l+e.position.x,i.position.y=p+e.position.y,e.scale.x*e.scale.y<0?i.rotation.rad=v(e.rotation.rad-n.rotation.rad):i.rotation.rad=v(n.rotation.rad+e.rotation.rad),i.scale.x=n.scale.x*e.scale.x,i.scale.y=n.scale.y*e.scale.y,i},t.extract=function(e,n,i){(i=i||new t).scale.x=e.scale.x/n.scale.x,i.scale.y=e.scale.y/n.scale.y,n.scale.x*n.scale.y<0?i.rotation.rad=v(n.rotation.rad+e.rotation.rad):i.rotation.rad=v(e.rotation.rad-n.rotation.rad);var o=e.position.x-n.position.x,a=e.position.y-n.position.y,r=-n.rotation.rad,s=Math.cos(r),c=Math.sin(r),l=s*o-c*a,p=c*o+s*a;return i.position.x=l/n.scale.x,i.position.y=p/n.scale.y,i},t.transform=function(t,e,n){n=n||new x;var i=e.x*t.scale.x,o=e.y*t.scale.y,a=t.rotation.rad,r=Math.cos(a),s=Math.sin(a),c=r*i-s*o,l=s*i+r*o;return n.x=c+t.position.x,n.y=l+t.position.y,n},t.untransform=function(t,e,n){n=n||new x;var i=e.x-t.position.x,o=e.y-t.position.y,a=-t.rotation.rad,r=Math.cos(a),s=Math.sin(a),c=r*i-s*o,l=s*i+r*o;return n.x=c/t.scale.x,n.y=l/t.scale.y,n},t.tween=function(t,e,n,i,o){return o.position.x=m(t.position.x,e.position.x,n),o.position.y=m(t.position.y,e.position.y,n),o.rotation.rad=g(t.rotation.rad,e.rotation.rad,n,i),o.scale.x=m(t.scale.x,e.scale.x,n),o.scale.y=m(t.scale.y,e.scale.y,n),o},t}();n.Space=S;var j=function(){function t(){this.id=-1,this.name=""}return t.prototype.load=function(t){return this.id=s(t,"id",-1),this.name=c(t,"name",""),this},t}();n.Element=j;var P=function(t){function e(e){var n=t.call(this)||this;return n.type="unknown",n.type=e,n}return o(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e);var n=c(e,"type","image");if(this.type!==n)throw new Error;return this},e}(j);n.File=P;var O=function(t){function e(){var e=t.call(this,"image")||this;return e.width=0,e.height=0,e.pivot=new E,e}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.width=s(e,"width",0),this.height=s(e,"height",0),this.pivot.x=r(e,"pivot_x",0),this.pivot.y=r(e,"pivot_y",1),this},e}(P);n.ImageFile=O;var T=function(t){function e(){return t.call(this,"sound")||this}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this},e}(P);n.SoundFile=T;var F=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.file_array=[],e}return o(e,t),e.prototype.load=function(e){var n=this;return t.prototype.load.call(this,e),this.file_array=[],e.file=l(e.file),e.file.forEach(function(t){switch(t.type){case"image":default:n.file_array.push((new O).load(t));break;case"sound":n.file_array.push((new T).load(t))}}),this},e}(j);n.Folder=F;var M=function(){function t(t){this.type="unknown",this.name="",this.type=t}return t.prototype.load=function(t){var e=c(t,"type","sprite");if(this.type!==e)throw new Error;return this},t}();n.BaseObject=M;var I=function(t){function e(){var e=t.call(this,"sprite")||this;return e.parent_index=-1,e.folder_index=-1,e.file_index=-1,e.local_space=new S,e.world_space=new S,e.default_pivot=!1,e.pivot=new E,e.z_index=0,e.alpha=1,e}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.parent_index=s(e,"parent",-1),this.folder_index=s(e,"folder",-1),this.file_index=s(e,"file",-1),this.local_space.load(e),this.world_space.copy(this.local_space),void 0!==e.pivot_x||void 0!==e.pivot_y?(this.pivot.x=r(e,"pivot_x",0),this.pivot.y=r(e,"pivot_y",1)):this.default_pivot=!0,this.z_index=s(e,"z_index",0),this.alpha=r(e,"a",1),this},e.prototype.copy=function(t){return this.parent_index=t.parent_index,this.folder_index=t.folder_index,this.file_index=t.file_index,this.local_space.copy(t.local_space),this.world_space.copy(t.world_space),this.default_pivot=t.default_pivot,this.pivot.copy(t.pivot),this.z_index=t.z_index,this.alpha=t.alpha,this},e.prototype.tween=function(t,e,n){S.tween(this.local_space,t.local_space,e,n,this.local_space),this.default_pivot||x.tween(this.pivot,t.pivot,e,this.pivot),this.alpha=m(this.alpha,t.alpha,e)},e}(M);n.SpriteObject=I;var N=function(t){function e(){var e=t.call(this,"bone")||this;return e.parent_index=-1,e.local_space=new S,e.world_space=new S,e}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.parent_index=s(e,"parent",-1),this.local_space.load(e),this.world_space.copy(this.local_space),this},e.prototype.copy=function(t){return this.parent_index=t.parent_index,this.local_space.copy(t.local_space),this.world_space.copy(t.world_space),this},e.prototype.tween=function(t,e,n){S.tween(this.local_space,t.local_space,e,n,this.local_space)},e}(M);n.Bone=N;var K=function(t){function e(){var e=t.call(this,"box")||this;return e.parent_index=-1,e.local_space=new S,e.world_space=new S,e.pivot=new E,e}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.parent_index=s(e,"parent",-1),this.local_space.load(e),this.world_space.copy(this.local_space),this.pivot.x=r(e,"pivot_x",0),this.pivot.y=r(e,"pivot_y",1),this},e.prototype.copy=function(t){return this.parent_index=t.parent_index,this.local_space.copy(t.local_space),this.world_space.copy(t.world_space),this.pivot.copy(t.pivot),this},e.prototype.tween=function(t,e,n){S.tween(this.local_space,t.local_space,e,n,this.local_space)},e}(M);n.BoxObject=K;var C=function(t){function e(){var e=t.call(this,"point")||this;return e.parent_index=-1,e.local_space=new S,e.world_space=new S,e}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.parent_index=s(e,"parent",-1),this.local_space.load(e),this.world_space.copy(this.local_space),this},e.prototype.copy=function(t){return this.parent_index=t.parent_index,this.local_space.copy(t.local_space),this.world_space.copy(t.world_space),this},e.prototype.tween=function(t,e,n){S.tween(this.local_space,t.local_space,e,n,this.local_space)},e}(M);n.PointObject=C;var R=function(t){function e(){var e=t.call(this,"sound")||this;return e.folder_index=-1,e.file_index=-1,e.trigger=!1,e.volume=1,e.panning=0,e}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.folder_index=s(e,"folder",-1),this.file_index=s(e,"file",-1),this.trigger=a(e,"trigger",!1),this.volume=r(e,"volume",1),this.panning=r(e,"panning",0),this},e.prototype.copy=function(t){return this.folder_index=t.folder_index,this.file_index=t.file_index,this.trigger=t.trigger,this.volume=t.volume,this.panning=t.panning,this},e.prototype.tween=function(t,e){this.volume=m(this.volume,t.volume,e),this.panning=m(this.panning,t.panning,e)},e}(M);n.SoundObject=R;var B=function(t){function e(){var e=t.call(this,"entity")||this;return e.parent_index=-1,e.local_space=new S,e.world_space=new S,e.entity_index=-1,e.animation_index=-1,e.animation_time=0,e}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.parent_index=s(e,"parent",-1),this.local_space.load(e),this.world_space.copy(this.local_space),this.entity_index=s(e,"entity",-1),this.animation_index=s(e,"animation",-1),this.animation_time=r(e,"t",0),this},e.prototype.copy=function(t){return this.parent_index=t.parent_index,this.local_space.copy(t.local_space),this.world_space.copy(t.world_space),this.entity_index=t.entity_index,this.animation_index=t.animation_index,this.animation_time=t.animation_time,this},e.prototype.tween=function(t,e,n){S.tween(this.local_space,t.local_space,e,n,this.local_space),this.animation_time=m(this.animation_time,t.animation_time,e)},e}(M);n.EntityObject=B;var V=function(t){function e(){return t.call(this,"variable")||this}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this},e.prototype.copy=function(){return this},e.prototype.tween=function(){},e}(M);n.VariableObject=V;var D=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.parent_index=-1,e.timeline_index=-1,e.keyframe_index=-1,e}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.parent_index=s(e,"parent",-1),this.timeline_index=s(e,"timeline",-1),this.keyframe_index=s(e,"key",-1),this},e}(j);n.Ref=D;var L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(D);n.BoneRef=L;var z=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.z_index=0,e}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.z_index=s(e,"z_index",0),this},e}(D);n.ObjectRef=z;var q=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.time=0,e}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.time=s(e,"time",0),this},e.find=function(t,e){if(t.length<=0)return-1;if(e<t[0].time)return-1;var n=t.length-1;if(e>=t[n].time)return n;var i=0,o=n;if(0===o)return 0;for(var a=o>>1;;){if(t[a+1].time<=e?i=a+1:o=a,i===o)return i;a=i+o>>1}},e.compare=function(t,e){return t.time-e.time},e}(j);n.Keyframe=q;var X=function(){function t(){this.type="linear",this.c1=0,this.c2=0,this.c3=0,this.c4=0}return t.prototype.load=function(t){return this.type=c(t,"curve_type","linear"),this.c1=r(t,"c1",0),this.c2=r(t,"c2",0),this.c3=r(t,"c3",0),this.c4=r(t,"c4",0),this},t.prototype.evaluate=function(t){switch(this.type){case"instant":return 0;case"linear":return t;case"quadratic":return h(0,this.c1,1,t);case"cubic":return f(0,this.c1,this.c2,1,t);case"quartic":return y(0,this.c1,this.c2,this.c3,1,t);case"quintic":return d(0,this.c1,this.c2,this.c3,this.c4,1,t);case"bezier":return _(this.c1,this.c2,this.c3,this.c4,t)}return 0},t}();n.Curve=X;var H=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curve=new X,e}return o(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e);var n=this;return n.curve.load(e),n.bone_ref_array=[],e.bone_ref=l(e.bone_ref),e.bone_ref.forEach(function(t){n.bone_ref_array.push((new L).load(t))}),n.bone_ref_array.sort(function(t,e){return t.id-e.id}),n.object_ref_array=[],e.object_ref=l(e.object_ref),e.object_ref.forEach(function(t){n.object_ref_array.push((new z).load(t))}),n.object_ref_array.sort(function(t,e){return t.id-e.id}),n},e}(q);n.MainlineKeyframe=H;var J=function(){function t(){}return t.prototype.load=function(t){var e=this;return e.keyframe_array=[],t.key=l(t.key),t.key.forEach(function(t){e.keyframe_array.push((new H).load(t))}),e.keyframe_array.sort(q.compare),e},t}();n.Mainline=J;var G=function(t){function e(e){var n=t.call(this)||this;return n.type="unknown",n.spin=1,n.curve=new X,n.type=e,n}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.spin=s(e,"spin",1),this.curve.load(e),this},e}(q);n.TimelineKeyframe=G;var Q=function(t){function e(){return t.call(this,"sprite")||this}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.sprite=(new I).load(e.object),this},e}(G);n.SpriteTimelineKeyframe=Q;var U=function(t){function e(){return t.call(this,"bone")||this}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),e.bone.type=e.bone.type||"bone",this.bone=(new N).load(e.bone),this},e}(G);n.BoneTimelineKeyframe=U;var W=function(t){function e(){return t.call(this,"box")||this}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),e.object.type=e.object.type||"box",this.box=(new K).load(e.object),this},e}(G);n.BoxTimelineKeyframe=W;var Y=function(t){function e(){return t.call(this,"point")||this}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),e.object.type=e.object.type||"point",this.point=(new C).load(e.object),this},e}(G);n.PointTimelineKeyframe=Y;var Z=function(t){function e(){return t.call(this,"sound")||this}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),e.object.type=e.object.type||"sound",this.sound=(new R).load(e.object),this},e}(G);n.SoundTimelineKeyframe=Z;var $=function(t){function e(){return t.call(this,"entity")||this}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),e.object.type=e.object.type||"entity",this.entity=(new B).load(e.object),this},e}(G);n.EntityTimelineKeyframe=$;var tt=function(t){function e(){return t.call(this,"variable")||this}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),e.object.type=e.object.type||"variable",this.variable=(new V).load(e.object),this},e}(G);n.VariableTimelineKeyframe=tt;var et=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tag_index=-1,e}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this},e}(j);n.TagDef=et;var nt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tag_def_index=-1,e}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.tag_def_index=s(e,"t",-1),this},e}(j);n.Tag=nt;var it=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e);var n=this;return n.tag_array=[],e.tag=l(e.tag),e.tag.forEach(function(t){n.tag_array.push((new nt).load(t))}),this},e}(q);n.TaglineKeyframe=it;var ot=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.keyframe_array=[],e}return o(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e);var n=this;return n.keyframe_array=[],e.key=l(e.key),e.key.forEach(function(t){n.keyframe_array.push((new it).load(t))}),this},e}(j);n.Tagline=ot;var at=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.load=function(e){switch(t.prototype.load.call(this,e),typeof e.val){case"number":this.val=r(e,"val",0);break;case"string":this.val=c(e,"val","")}return this},e}(q);n.VarlineKeyframe=at;var rt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.var_def_index=-1,e}return o(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e);var n=this;return n.var_def_index=s(e,"def",-1),n.keyframe_array=[],e.key=l(e.key),e.key.forEach(function(t){n.keyframe_array.push((new at).load(t))}),this},e}(j);n.Varline=rt;var st=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e);var n=this;return n.tagline=new ot,e.tagline&&n.tagline.load(e.tagline),n.varline_array=[],e.valline=e.valline||null,e.varline=e.varline||e.valline,e.varline&&(e.varline=l(e.varline),e.varline.forEach(function(t){n.varline_array.push((new rt).load(t))})),this},e}(j);n.Meta=st;var ct=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="sprite",e.object_index=-1,e}return o(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e);var n=this;switch(n.type=c(e,"object_type","sprite"),n.object_index=s(e,"obj",-1),n.keyframe_array=[],e.key=l(e.key),n.type){case"sprite":e.key.forEach(function(t){n.keyframe_array.push((new Q).load(t))});break;case"bone":e.key.forEach(function(t){n.keyframe_array.push((new U).load(t))});break;case"box":e.key.forEach(function(t){n.keyframe_array.push((new W).load(t))});break;case"point":e.key.forEach(function(t){n.keyframe_array.push((new Y).load(t))});break;case"sound":e.key.forEach(function(t){n.keyframe_array.push((new Z).load(t))});break;case"entity":e.key.forEach(function(t){n.keyframe_array.push((new $).load(t))});break;case"variable":e.key.forEach(function(t){n.keyframe_array.push((new tt).load(t))});break;default:console.log("TODO: Timeline::load",n.type,e.key)}return n.keyframe_array.sort(q.compare),e.meta&&(n.meta=(new st).load(e.meta)),n},e}(j);n.Timeline=ct;var lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),e.object.type=e.object.type||"sound",this.sound=(new R).load(e.object),this},e}(q);n.SoundlineKeyframe=lt;var pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e);var n=this;return n.keyframe_array=[],e.key=l(e.key),e.key.forEach(function(t){n.keyframe_array.push((new lt).load(t))}),n.keyframe_array.sort(q.compare),this},e}(j);n.Soundline=pt;var ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this},e}(q);n.EventlineKeyframe=ut;var ht=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e);var n=this;return n.keyframe_array=[],e.key=l(e.key),e.key.forEach(function(t){n.keyframe_array.push((new ut).load(t))}),n.keyframe_array.sort(q.compare),this},e}(j);n.Eventline=ht;var ft=function(){function t(){this.folder_index=-1,this.file_index=-1,this.target_folder_index=-1,this.target_file_index=-1}return t.prototype.load=function(t){return this.folder_index=s(t,"folder",-1),this.file_index=s(t,"file",-1),this.target_folder_index=s(t,"target_folder",-1),this.target_file_index=s(t,"target_file",-1),this},t}();n.MapInstruction=ft;var yt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.map_instruction_array=[],e}return o(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e);var n=this;return n.map_instruction_array=[],e.map=l(e.map),e.map.forEach(function(t){var e=(new ft).load(t);n.map_instruction_array.push(e)}),this},e}(j);n.CharacterMap=yt;var dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.load=function(e){switch(t.prototype.load.call(this,e),this.type=this.default_value=c(e,"type",""),this.type){case"int":this.value=this.default_value=s(e,"default_value",0);break;case"float":this.value=this.default_value=r(e,"default_value",0);break;case"string":this.value=this.default_value=c(e,"default_value","")}return this},e}(j);n.VarDef=dt;var _t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e);var n=this;this.var_def_array=[];var i=[];return"object"==typeof e.i?i=l(e.i):"object"==typeof e&&"number"==typeof e.length&&(i=l(e)),i.forEach(function(t){n.var_def_array.push((new dt).load(t))}),this},e}(j);n.VarDefs=_t;var mt=function(t){function e(e){var n=t.call(this)||this;return n.type="unknown",n.type=e,n}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.var_defs=(new _t).load(e.var_defs||{}),this},e}(j);n.ObjInfo=mt;var vt=function(){function t(){this.folder_index=-1,this.file_index=-1}return t.prototype.load=function(t){return this.folder_index=s(t,"folder",-1),this.file_index=s(t,"file",-1),this},t}();n.SpriteFrame=vt;var gt=function(t){function e(){return t.call(this,"sprite")||this}return o(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e);var n=this;return n.sprite_frame_array=[],e.frames=l(e.frames),e.frames.forEach(function(t){n.sprite_frame_array.push((new vt).load(t))}),this},e}(mt);n.SpriteObjInfo=gt;var bt=function(t){function e(){var e=t.call(this,"bone")||this;return e.w=0,e.h=0,e}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.w=s(e,"w",0),this.h=s(e,"h",0),this},e}(mt);n.BoneObjInfo=bt;var xt=function(t){function e(){var e=t.call(this,"box")||this;return e.w=0,e.h=0,e}return o(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.w=s(e,"w",0),this.h=s(e,"h",0),this},e}(mt);n.BoxObjInfo=xt;var wt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.length=0,e.looping="true",e.loop_to=0,e.min_time=0,e.max_time=0,e}return o(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e);var n=this;return n.length=s(e,"length",0),n.looping=c(e,"looping","true"),n.loop_to=s(e,"loop_to",0),n.mainline=(new J).load(e.mainline||{}),n.timeline_array=[],e.timeline=l(e.timeline),e.timeline.forEach(function(t){n.timeline_array.push((new ct).load(t))}),n.soundline_array=[],e.soundline=l(e.soundline),e.soundline.forEach(function(t){n.soundline_array.push((new pt).load(t))}),n.eventline_array=[],e.eventline=l(e.eventline),e.eventline.forEach(function(t){n.eventline_array.push((new ht).load(t))}),e.meta&&(n.meta=(new st).load(e.meta)),n.min_time=0,n.max_time=n.length,this},e}(j);n.Animation=wt;var kt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e);var n=this;return n.character_map_map={},n.character_map_keys=[],e.character_map=l(e.character_map),e.character_map.forEach(function(t){var e=(new yt).load(t);n.character_map_map[e.name]=e,n.character_map_keys.push(e.name)}),this.var_defs=(new _t).load(e.var_defs||{}),n.obj_info_map={},n.obj_info_keys=[],e.obj_info=l(e.obj_info),e.obj_info.forEach(function(t){var e;switch(t.type){case"sprite":e=(new gt).load(t);break;case"bone":e=(new bt).load(t);break;case"box":e=(new xt).load(t);break;case"point":case"sound":case"entity":case"variable":default:console.log("TODO: Entity.load",t.type,t),e=new mt(t.type).load(t)}n.obj_info_map[e.name]=e,n.obj_info_keys.push(e.name)}),n.animation_map={},n.animation_keys=[],e.animation=l(e.animation),e.animation.forEach(function(t){var e=(new wt).load(t);n.animation_map[e.name]=e,n.animation_keys.push(e.name)}),this},e}(j);n.Entity=kt;var At=function(){function t(){this.folder_array=[],this.tag_def_array=[],this.entity_map={},this.entity_keys=[]}return t.prototype.load=function(t){var e=this;return c(t,"scon_version",""),c(t,"generator",""),c(t,"generator_version",""),e.folder_array=[],t.folder=l(t.folder),t.folder.forEach(function(t){e.folder_array.push((new F).load(t))}),e.tag_def_array=[],t.tag_list=l(t.tag_list),t.tag_list.forEach(function(t){e.tag_def_array.push((new et).load(t))}),e.entity_map={},e.entity_keys=[],t.entity=l(t.entity),t.entity.forEach(function(t){var n=(new kt).load(t);e.entity_map[n.name]=n,e.entity_keys.push(n.name)}),e.entity_keys.forEach(function(t){var n=e.entity_map[t];n.animation_keys.forEach(function(t){n.animation_map[t].timeline_array.forEach(function(t){t.keyframe_array.forEach(function(t){if(t instanceof Q){var n=t.sprite;if(n.default_pivot){var i=e.folder_array[n.folder_index],o=i&&i.file_array[n.file_index];o&&n.pivot.copy(o.pivot)}}})})})}),this},t.prototype.getEntities=function(){return this.entity_map},t.prototype.getEntityKeys=function(){return this.entity_keys},t.prototype.getAnims=function(t){var e=this.entity_map&&this.entity_map[t];return e?e.animation_map:{}},t.prototype.getAnimKeys=function(t){var e=this.entity_map&&this.entity_map[t];return e?e.animation_keys:[]},t}();n.Data=At;var Et=function(){function t(t){this.entity_key="",this.character_map_key_array=[],this.anim_key="",this.time=0,this.elapsed_time=0,this.dirty=!0,this.bone_array=[],this.object_array=[],this.sound_array=[],this.event_array=[],this.tag_array=[],this.var_map={},this.data=t}return t.prototype.getEntities=function(){return this.data?this.data.getEntities():null},t.prototype.getEntityKeys=function(){return this.data?this.data.getEntityKeys():null},t.prototype.curEntity=function(){var t=this.data.entity_map;return t&&t[this.entity_key]},t.prototype.getEntity=function(){return this.entity_key},t.prototype.setEntity=function(t){this.entity_key!==t&&(this.entity_key=t,this.anim_key="",this.time=0,this.dirty=!0,this.bone_array=[],this.object_array=[])},t.prototype.getAnims=function(){return this.data?this.data.getAnims(this.entity_key):null},t.prototype.getAnimKeys=function(){return this.data?this.data.getAnimKeys(this.entity_key):null},t.prototype.curAnim=function(){var t=this.getAnims();return t&&t[this.anim_key]},t.prototype.curAnimLength=function(){var t=this.data,e=t&&t.entity_map[this.entity_key],n=e&&e.animation_map[this.anim_key];return n&&n.length||0},t.prototype.getAnim=function(){return this.anim_key},t.prototype.setAnim=function(t){if(this.anim_key!==t){this.anim_key=t;var e=this.curAnim();e&&(this.time=p(this.time,e.min_time,e.max_time)),this.elapsed_time=0,this.dirty=!0}},t.prototype.getTime=function(){return this.time},t.prototype.setTime=function(t){var e=this.curAnim();e&&(t=p(t,e.min_time,e.max_time)),this.time!==t&&(this.time=t,this.elapsed_time=0,this.dirty=!0)},t.prototype.update=function(t){this.elapsed_time+=t,this.dirty=!0},t.prototype.strike=function(){var e=this;if(e.dirty){e.dirty=!1;var n=e.curEntity();e.var_map=e.var_map||{},n.var_defs.var_def_array.forEach(function(t){t.name in e.var_map||(e.var_map[t.name]=t.default_value)});var i=e.curAnim(),o=e.time,a=e.elapsed_time;e.time=e.time+e.elapsed_time,e.elapsed_time=0;var r=!1,s=!1;i&&(r=a<0&&e.time<=i.min_time,s=a>0&&e.time>=i.max_time,e.time=p(e.time,i.min_time,i.max_time));var c=e.time;if(i){var l=i.mainline.keyframe_array,u=q.find(l,c),h=(u+1)%l.length,f=l[u],y=l[h],d=f.time,_=y.time;_<d&&(_=i.length);var v=c;if(d!==_){var g=(c-d)/(_-d);g=f.curve.evaluate(g),v=m(d,_,g)}var b=i.timeline_array,x=f.bone_ref_array,w=e.bone_array;x.forEach(function(t,e){var n=t.timeline_index,o=b[n],a=o.keyframe_array,r=t.keyframe_index,s=(r+1)%a.length,c=a[r],l=a[s],p=c.time,u=l.time;u<p&&(u=i.length);var h=0;p!==u&&(h=(v-p)/(u-p),h=c.curve.evaluate(h));var f=w[e]=w[e]||new N,y=c,d=l;f.copy(y.bone).tween(d.bone,h,c.spin),f.name=o.name,f.parent_index=t.parent_index}),w.length=x.length,w.forEach(function(t){var e=w[t.parent_index];e?S.combine(e.world_space,t.local_space,t.world_space):t.world_space.copy(t.local_space)});var k=f.object_ref_array,A=e.object_array;if(k.forEach(function(t,e){var n=t.timeline_index,o=b[n],a=o.keyframe_array,r=t.keyframe_index,s=(r+1)%a.length,c=a[r],l=a[s],p=c.time,u=l.time;u<p&&(u=i.length);var h=0;switch(p!==u&&(h=(v-p)/(u-p),h=c.curve.evaluate(h)),o.type){case"sprite":var f=A[e]=A[e]||new I,y=c,d=l;f.copy(y.sprite).tween(d.sprite,h,c.spin),f.name=o.name,f.parent_index=t.parent_index;break;case"bone":var _=A[e]=A[e]||new N,m=c,g=l;_.copy(m.bone).tween(g.bone,h,c.spin),_.name=o.name,_.parent_index=t.parent_index;break;case"box":var x=A[e]=A[e]||new K,w=c,k=l;x.copy(w.box).tween(k.box,h,c.spin),x.name=o.name,x.parent_index=t.parent_index;break;case"point":var E=A[e]=A[e]||new C,S=c,j=l;E.copy(S.point).tween(j.point,h,c.spin),E.name=o.name,E.parent_index=t.parent_index;break;case"sound":var P=A[e]=A[e]||new R,O=c,T=l;P.copy(O.sound).tween(T.sound,h,c.spin),P.name=o.name;break;case"entity":var F=A[e]=A[e]||new B,M=c,D=l;F.copy(M.entity).tween(D.entity,h,c.spin),F.name=o.name,F.parent_index=t.parent_index;break;case"variable":var L=A[e]=A[e]||new V,z=c,q=l;L.name=o.name,L.copy(z.variable).tween(q.variable,h,c.spin);break;default:throw new Error(o.type)}}),A.length=k.length,e.character_map_key_array.forEach(function(t){var e=n.character_map_map[t];e&&e.map_instruction_array.forEach(function(t){A.forEach(function(e){switch(e.type){case"sprite":var n=e;n.folder_index===t.folder_index&&n.file_index===t.file_index&&(n.folder_index=t.target_folder_index,n.file_index=t.target_file_index);break;case"bone":case"box":case"sound":case"event":case"entity":case"variable":break;default:throw new Error(e.type)}})})}),A.forEach(function(t){switch(t.type){case"sprite":var i=t,o=w[i.parent_index];o?S.combine(o.world_space,i.local_space,i.world_space):i.world_space.copy(i.local_space);var a=e.data.folder_array[i.folder_index],r=a&&a.file_array[i.file_index];if(r){var s=r,c=i.default_pivot?s.pivot:i.pivot,l=(.5-c.x)*s.width,p=(.5-c.y)*s.height;S.translate(i.world_space,l,p)}break;case"bone":var u=t,h=w[u.parent_index];h?S.combine(h.world_space,u.local_space,u.world_space):u.world_space.copy(u.local_space);break;case"box":var f=t,y=w[f.parent_index];y?S.combine(y.world_space,f.local_space,f.world_space):f.world_space.copy(f.local_space);var d=n.obj_info_map[t.name];if(d){var _=d;l=(.5-f.pivot.x)*_.w,p=(.5-f.pivot.y)*_.h,S.translate(f.world_space,l,p)}break;case"point":var m=t,v=w[m.parent_index];v?S.combine(v.world_space,m.local_space,m.world_space):m.world_space.copy(m.local_space);break;case"sound":break;case"entity":var g=t,b=w[g.parent_index];b?S.combine(b.world_space,g.local_space,g.world_space):g.world_space.copy(g.local_space);break;case"variable":break;default:throw new Error(t.type)}}),A.forEach(function(n){switch(n.type){case"entity":var i=n,o=i.pose=i.pose||new t(e.data),a=o.data.entity_keys[i.entity_index];a!==o.getEntity()&&o.setEntity(a);var r=o.curEntity().animation_keys[i.animation_index];if(r!==o.getAnim()){o.setAnim(r);var s=o.curAnimLength(),c=i.animation_time*s;o.setTime(c)}else{s=o.curAnimLength();var l=(c=i.animation_time*s)-o.getTime();o.update(l)}o.strike()}}),e.sound_array=[],i.soundline_array.forEach(function(t){function n(t){var n=e.data.folder_array[t.sound.folder_index],i=n&&n.file_array[t.sound.file_index];e.sound_array.push({name:i.name,volume:t.sound.volume,panning:t.sound.panning})}a<0?r?t.keyframe_array.forEach(function(t){(i.min_time<=t.time&&t.time<o||c<=t.time&&t.time<=i.max_time)&&n(t)}):t.keyframe_array.forEach(function(t){c<=t.time&&t.time<o&&n(t)}):s?t.keyframe_array.forEach(function(t){(i.min_time<=t.time&&t.time<=c||o<t.time&&t.time<=i.max_time)&&n(t)}):t.keyframe_array.forEach(function(t){o<t.time&&t.time<=c&&n(t)})}),e.event_array=[],i.eventline_array.forEach(function(t){function n(){e.event_array.push(t.name)}a<0?r?t.keyframe_array.forEach(function(t){(i.min_time<=t.time&&t.time<o||c<=t.time&&t.time<=i.max_time)&&n()}):t.keyframe_array.forEach(function(t){c<=t.time&&t.time<o&&n()}):s?t.keyframe_array.forEach(function(t){(i.min_time<=t.time&&t.time<=c||o<t.time&&t.time<=i.max_time)&&n()}):t.keyframe_array.forEach(function(t){o<t.time&&t.time<=c&&n()})}),i.meta){if(i.meta.tagline){var E=function(t){e.tag_array=[],t.tag_array.forEach(function(t){var n=e.data.tag_def_array[t.tag_def_index];e.tag_array.push(n.name)}),e.tag_array.sort()};a<0?r?i.meta.tagline.keyframe_array.forEach(function(t){(i.min_time<=t.time&&t.time<o||c<=t.time&&t.time<=i.max_time)&&E(t)}):i.meta.tagline.keyframe_array.forEach(function(t){c<=t.time&&t.time<o&&E(t)}):s?i.meta.tagline.keyframe_array.forEach(function(t){(i.min_time<=t.time&&t.time<=c||o<t.time&&t.time<=i.max_time)&&E(t)}):i.meta.tagline.keyframe_array.forEach(function(t){o<t.time&&t.time<=c&&E(t)})}e.var_map=e.var_map||{},i.meta.varline_array.forEach(function(t){var o=t.keyframe_array,a=q.find(o,c);if(-1!==a){var r=(a+1)%o.length,s=o[a],l=o[r],p=s.time,u=l.time;u<p&&(u=i.length);var h=0;p!==u&&(h=(c-p)/(u-p));var f=n.var_defs.var_def_array[t.var_def_index],y=0;switch(f.type){case"int":y=0|m(+s.val,+l.val,h);break;case"float":y=m(+s.val,+l.val,h);break;case"string":y=s.val}e.var_map[f.name]=y}})}}}},t}();n.Pose=Et,cc._RF.pop()},{}],"use_v2.1-2.2.1_cc.Toggle_event":[function(t,e){"use strict";cc._RF.push(e,"1ecc10r/4REi4TuVnCloyDX","use_v2.1-2.2.1_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_isChecked=!0),cc._RF.pop()},{}]},{},["use_v2.1-2.2.1_cc.Toggle_event","SconAnim","spriter","scene_scon"]);